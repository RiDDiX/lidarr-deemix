version: '3.8'

services:
  lidarr-deemix:
    image: ghcr.io/riddix/lidarr-deemix:latest
    # Alternativ: lokal bauen mit
    # build: .
    container_name: lidarr-deemix
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      # ===========================================
      # REQUIRED: Your Deezer ARL token
      # Get it from: deezer.com -> DevTools -> Cookies -> arl
      # ===========================================
      - DEEMIX_ARL=${DEEMIX_ARL}
      
      # ===========================================
      # OPTIONAL: Feature Flags
      # ===========================================
      # Prioritize Deezer albums over MusicBrainz
      - PRIO_DEEMIX=${PRIO_DEEMIX:-false}
      
      # Use Deezer data ONLY (ignore MusicBrainz)
      # WARNING: This will remove MB-imported artists!
      - OVERRIDE_MB=${OVERRIDE_MB:-false}
      
      # ===========================================
      # OPTIONAL: Lidarr Connection (for OVERRIDE_MB)
      # ===========================================
      - LIDARR_URL=${LIDARR_URL:-}
      - LIDARR_API_KEY=${LIDARR_API_KEY:-}
      
      # ===========================================
      # OPTIONAL: Logging
      # ===========================================
      - LOG_LEVEL=${LOG_LEVEL:-info}
      
    volumes:
      - ./config:/app/config
      - ./logs:/app/logs
      
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# ===========================================
# Example: Full stack with Lidarr
# ===========================================
#   lidarr:
#     image: linuxserver/lidarr:latest
#     container_name: lidarr
#     environment:
#       - PUID=1000
#       - PGID=1000
#       - TZ=Europe/Berlin
#     volumes:
#       - ./lidarr-config:/config
#       - ./music:/music
#     ports:
#       - "8686:8686"
#     # Configure in Lidarr UI:
#     # Settings -> General -> Use Proxy -> HTTP(S)
#     # Hostname: lidarr-deemix
#     # Port: 8080